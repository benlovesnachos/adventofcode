using System;
using System.Runtime.InteropServices;

namespace AdventOfCodeDay03
{
    class Program
    {
        public static string[] testData = { "..##.......", "#...#...#..", ".#....#..#.", "..#.#...#.#", ".#...##..#.", "..#.##.....", ".#.#.#....#", ".#........#", "#.##...#...", "#...##....#", ".#..#...#.#" };
        public static string[] mapData = { ".#....#..##.#..####....#.......", "......#..#....#....###......#.#", "#..#.....#..............##.#.#.", "#.#...#....#...#......##..#..#.", "...#..#.##..#..#........###.#.#", "...#.#..........#.........##...", "...#.#....#.#....#..#......#...", "..##.#.....#.......#.###..#..##", "..#.......#.......#....##......", "....##........##.##...#.###.##.", "#.......#.......##..#......#...", "..##.............##.#......#...", "...#.####....#.....#...##......", ".............##.#......#.......", "..#...#....#......#....#.......", "..#....#..#............#.......", "##...#..#........##..#......#..", "##........##........#.#.......#", "#.......#........#.#..#....###.", ".....#..#.#..........##...#....", "..##...#......#.#...#..#...#...", "##.##...#......#....#....#...#.", "#.......#..#.#..#....#..###.#.#", "#.............#.#....#..#.#....", "...#.......###.#.##.##.#...#..#", ".##.......##..##...#..###......", ".......#.#.#.#..####..#..#..#..", "...##......#.#.##.###....#.###.", "###......###......#.#####..#...", "..#........##..#..##.##..#...#.", ".....##..#...#..#.##.....#.#...", "#......#.##....#..##.#....#.#..", "##.#.##..#................#....", "......#.#....#......##.....#...", "..#...##..#..#...#..#.#..#.....", "........#.#.#.##...#.#.....#.#.", "#.#......#.....##..#...#.......", "..#.#......#...........###.....", "......##....#....##..#..#.#.#.#", "##....#.###...#......#..#...#..", "#.#.##....###...####.......#..#", "##...........#.....#........#.#", ".##.#..#.....#......#.......#..", "##..##..###....#.........##....", "..#..#..#.##...#.#...#........#", "#.##.###...#.......#...........", ".........#.................#...", "#.##...#.....#..##........#....", "....#.#...##...#...........#...", ".#.....#.#..#...##..##.....#...", ".#.....####....#..##..#........", "...#..#......##.#..##.#.#.#..#.", ".##.#.....#.....#...#.......##.", "......#..#..#......#...####....", ".......#......##..#..##.....#..", "......#.#..#...#..#.#..........", "....##.........#...............", ".#....#..##.....#....##.##.....", "#.#.....#...#....####....#.#...", "#.....#....#.#...#.............", "...#..#.....#....##..#..#......", "...#.#............#...........#", "###.#..#.#......#.....##.....#.", "####....#....###.....#..#.#####", ".###..#...#.#..#......##.#.#.#.", ".....#.##.#....#..##....#..#..#", "...#....#...##.....#......#.#..", "....#...#....#...#....#.....#.#", ".#.....#.....#.#..#......#..#..", "..#..##....##.##....#.....##...", "#..##...#.##...#..#.#.#.....#..", "...#..##.#..#....#.#....######.", "..........#..#.....#....#...##.", "#.#####.#.###..#.....#.........", "#....#......#..#.#.##.##..###..", "..#...###.#.#....##.##...##....", ".......#....#..#...##......#...", "...#.#...#..#.....#..##.#......", "###..##...........#............", "..#....#.##....#.#..##...#.....", "##....#...#....#.....#.#..##...", "..............#.##.#..#..##.###", "......#..#..#..#.#....###...##.", ".#...#..#.#.#....#..........#..", "..#.#.....#..#...........#.##..", "...#.#......#......#..#..#.#...", "...#....#.#.#.....#...#.##..#..", ".#.#..#...#........##.......#..", "##..........#..#...#....###.#..", "#.....###......#..#.#.#....#.#.", "..###.......#.#...............#", "#....#.....#.#......#..##.##...", "#.##.#.#....#..#.#...#.#...#..#", "#....#..#...........#.......#..", "...#.####.....#.........###.##.", "......#..#.....#..........#..#.", "#...#.#..####...#...#.#.##...##", ".##.........#......#.#.#.......", ".......##...##.##....###...##..", "...#..#....#..#.#.#.....#.#....", "#....#.#.#.......##..###..##...", "......#............#.#...#..#..", "#.#.....#......#...#.......###.", "...#.#................#...#....", ".....#......#.#..#...##.#.#...#", "#....#.#..#..#..##..#.##..#....", "#.................#..#....#....", "..#....#.......####....###.....", ".#..#.#.#...###..#...#..###....", "..#..#.#......#.###..........#.", ".....#......#.......##....##.#.", ".#....#........#.#.##.#........", "#.#..##..#..#.#...####....##...", "...#....#.#..#...#..........#..", ".#.....#.##....#...##..........", "....##....#.....#.....#...#.###", ".#...##.#.#..##..#...#.#..#..#.", "..#.......#.##.....#.#........#", "...#...#.....##..#.#.#....#....", "...#.....#.......##.........#.#", ".##.....#..#.#...#.#...#.#...#.", "...........#...#.###..#...#..#.", "#.##........#..###.##...####...", ".#.....#.#...##...#..#..#...##.", "..#....#..#...#.....#.....##...", "..###..#.#.....##........#.##..", ".#.#..##........#.##....#..#.##", ".####.#..##..#.#..#....##....#.", ".##....##...#.#........#.......", "....#..#..#...#..#..#..#.#.....", "...#......................#....", "#.....#.#....#..#..#.#..#....#.", "##.....#.....##..........###...", ".#..#..............#...##.#.#.#", "...#...#.#.............#.#..#.#", "..#.....#.......#......#.#.....", ".###.#..#..#..#.#..#.....#.....", ".....##..##...##.......#....###", ".#........###...##..#....##....", "#....#.#......##..#....#.##..#.", "#....#.#...#........##...###...", ".#.....#...#.###....#.##.#.####", "###......#....#...#....##..#..#", "##....#..###......#...#.#.#....", "..........#......##.#..#.......", ".#..#......###.........##...#..", "....#......#....#.........#.#.#", "##.#.#...#.#...#...#..#......#.", "....#.##.........#..#.....##.#.", "........#...#..#.#.#.#.....##..", "..#......#.#.#..#.....##.......", "..............#....#....##.#..#", "....#.#.....#....#.#.###.#....#", "..#..........#..#......#.##..#.", "...#...#.#.............#..#....", "#.......#..#..##.........##..#.", "..##..#............#.....#.....", "....#.#..##...#.#..#.........#.", "........#.......#.##....#....#.", "...#.....#.#.....#.#....#......", "..#......##.#.............#.#.#", "#.#.............#.#.....#......", ".##....##.#.....#....#...##....", ".#.#....##....#.....##.........", "...#.....#.....#.....#..#.###..", ".......#....#...##.#...#...#..#", "..#.#.......#...###.#...#....#.", ".....###..##....###.#.##.......", "....#..................##.#.##.", ".#.......###.##...#.#.....#....", "....#....##...##.....#.#...#..#", "#..#.....#......##...#....#....", "#..##.........#.....#...#......", "...#..##.......##......#..#####", ".#..###.###.#.##........#......", ".#...#....#....#.#....#...##...", "##........#....#.........##..#.", ".#.....##............#.#.......", "....#....#...........###.....##", ".#......#.#.#..#....#.#.....##.", "......#.##.#..##....#.#.#..#...", "#....#......#...#..####........", "......#..#..##..#.......#.#..#.", "##....##.###.#...#.##.#..#.###.", ".#.........#...##...#.#......#.", "..#.#...........####.#....##.##", ".....#.#..##.#...###...#..#.#..", "...#..#..##.#...#.....#.##...##", "..##......##..........#..###...", ".#......##.....#.##....#.#.##.#", "...#.......##..##.....#....#...", ".##...#...#....#..#............", "#..#....#...........#..........", "......#...#.#.......#...#.##..#", "..#.###..#.....#.....#..#.....#", "....#....#..........##....#..#.", ".......##.#.#.#......#....#...#", "####..#.###........#..#......#.", "#........##.#.#.#.............#", ".#......#......#..#.##.....#...", ".....##.##......##.#.....#.#.#.", ".......##.#.....##.......#.#.#.", ".#.#..#.#..#.##...#.#....#.#..#", ".#..##....#..#...##.......#..#.", ".#.#..#.......#................", "#........#.#.#......#.#.#.#....", "##......#...#..##.#...##.##....", "##.#..#...........##...#..###..", "......#.####...#........#.#.#..", "...#........##..###.#.#...#...#", ".#.....##..#......##......###..", "..#.#...#......#..#..##.#.....#", "#....#..#.#..........#...#.....", ".#......#.##..###..#.#....#..##", ".......#.......#..#..#......#..", "..##.....##.#..#..#.....##.....", "........#.##...#.#.#..#..#..#..", "...#.######.........#.....#..##", ".#.#............#....#.........", "#...#....###.#......#.#........", "#.........#....#...##..........", "....#...........#.###.#...###..", ".........#........#.#.#..#...#.", ".#.......#.#.....#.#.....#.##..", ".....#.......#.....#.#.#.......", "#.##..#..##.......#...#......#.", ".###.....##...##.#...##.##.#.#.", "...#......##..##............#.#", "...#......................#..##", "#..#..#................#...#...", "#..#....#.#.#...##.......#..#..", "....#.#..###.##...#..#.###..#..", "..#...#....####.#............#.", "......#....#.#...#.#.#.........", "#...#........#.....##..###.#..#", "#....#...#...##...#..#....##...", "#..#...#..#.......#.#..##.#..#.", "#.#..........#...........##....", ".#...###...#......#.......#.#.#", ".........#.........#...#...##..", "##.#..###......##..#.....#..#..", "....##...............#.....#...", ".....#.....###.#.....#.#.......", "....#..#......###..#..##..#....", "......................#.....#..", "..#..#...##....##....#........#", "..#....#...#...#.......#.....#.", "...##.#.#.##......#.#.#.#.####.", ".###...#..#......#.#..#........", "#..#...##.#..#..##..##....#...#", "...#...#..#..#..#........#..##.", ".##....#.##.#....#...#.#.#....#", "#..#....#..#....#.......##..#.#", "...#.#....####...........#...#.", "#...#####...#.#..#......#...#.#", ".##....#.#.#..#......#..##.....", "..........#..#.#.#.....##......", ".....#....#..................#.", ".........#...#...#....#..###...", ".#.#.#....#....................", "......##............##.###..#..", "#.#...#........####.##..#.#.##.", "#........#.#.#.#..#.##.....#...", "......####..#.##.......#....#..", ".........#...#...#.....#.......", "..##.....#...#...#.....##.....#", "....#...##....#.....#..#..##.##", "..#.........##...##..###..#....", "#....#.#.........##.###.#...##.", ".##...#....#..#..#.#....##.....", "##..#..#..#...........#.##....#", "....#..........#...#..#.....#..", "........###..#..#.#.#.....##...", "#...#...#..###............###..", "..#.....#.#.#..#..#.#..#......#", "..#...##..#....#...#......#....", "#....#........##.....#..##....#", "#.....#.#.#..#.......##.#.#.##.", "..##...#...#.....#..........#..", "##.....#....#......#..........#", "......#..#..........#.#..####..", "......#...#............##...##.", "..#.......##.......#...###.###.", ".#..#.#.#...#..##.#......#.#...", ".##.....##.#.#...#.##.........#", "#.#.######...........#.#####.#.", "........#.##...##....##.#.##.#.", "....#......#.....#.....###...##", "#..............#.#....#.#....#.", "....#..###.#.........##.#.#....", "..#.#.#..##....####..........#.", "...#..#.......#................", "...#....#..............#....#..", ".....#...#...#....#.#.#..#...#.", "......##.............###.##..##", ".#...#.#..#......#..#.##.......", "##.....#.....#.##...#....#.....", "..#..#.#.#.#.#..........#..###.", "##..........#........#....#.#..", ".....#...#........#.#..###....#", ".###.#........#.##......#.#...#", "#...##....#....#....##.#.#.....", ".....#.#............#..........", "..#.##....................#....", ".....#..#..#.#..#.##.......#...", ".....###......#......##......##", "#.....#.#.......##.......#...#.", ".#.#...#......#..###...#.....#.", "#.#..#...#..##.....#...#.#..#..", ".....#.#..........#..#.........", ".###..##..##.....#...#...#..##.", "#...#.#....#.......##..#.......", "###...#.#.#..#.......#......#..", "....##........#..........##....", "............#....#...........#.", "#..#.#....##..#.#..#......##...", ".###....##...#....##..........#", ".###........#........###.....#.", "...#...#.#......#...#....#.....", ".###.......#.........#.........", "....##.#......#...###......##.#", ".###...#..##.....##.......#....", ".#.#...#..#.##....#........#..." };

        static void Main(string[] args)
        {
            Console.WriteLine("Hello World! {0}", args.Length);
            if (args.Length == 2)
            {
                AdventOfCodeDay03.Program.runWithArgs(Program.testData, args);
            }
            else
            {
                Int64 treesHitProduct = 1;
                var useMap = Program.mapData;
                treesHitProduct *= AdventOfCodeDay03.Program.doWork(useMap, 1, 1);
                treesHitProduct *= AdventOfCodeDay03.Program.doWork(useMap, 3, 1);
                treesHitProduct *= AdventOfCodeDay03.Program.doWork(useMap, 5, 1);
                treesHitProduct *= AdventOfCodeDay03.Program.doWork(useMap, 7, 1);
                treesHitProduct *= AdventOfCodeDay03.Program.doWork(useMap, 1, 2);

                Console.WriteLine("Tree hit product: {0}... that's a lot of trees!", treesHitProduct);
            }
        }

        public static void runWithArgs(string[] mapData, string[] args)
        {
            var right = 3;
            var down = 1;

            if (args.Length == 2)
            {
                right = Int32.Parse(args[0]);
                down = Int32.Parse(args[1]);
            }

            AdventOfCodeDay03.Program.doWork(mapData, right, down);


        }

        public static int doWork(string[] mapData, int rightStep, int downStep)
        {
            var tree = "#";
            var treesHit = 0;
            var downOrdinate = 0;
            var rightOrdinate = 0;
            var hillLength = mapData.Length;

            // Set the first step;
            downOrdinate += downStep;
            rightOrdinate += rightStep;

            for (var i = 0; i < hillLength; i++)
            {

                var checkLine = false;
                var mapLine = mapData[i];
                if (i == downOrdinate)
                {
                    // landed on this line!
                    checkLine = true;
                    //Console.WriteLine("{0}   Hill step {1}", mapData[i], i);
                    while (mapLine.Length <= rightOrdinate)
                    {
                        mapLine += mapLine;
                    }
                    if (mapLine[rightOrdinate].ToString() == tree)
                    {
                        treesHit++;
                        mapLine = mapLine.ReplaceAt(rightOrdinate, 1, "X");
                    }
                    else
                    {
                        mapLine = mapLine.ReplaceAt(rightOrdinate, 1, "O");
                    }

                    downOrdinate += downStep;
                    rightOrdinate += rightStep;

                }
                else
                {
                    // skip this line...
                    checkLine = false;
                }


                //if (downStep == 2) Console.WriteLine("{0}   hill step {1} right {2} down {3} check {4}", mapLine, i, rightOrdinate, downOrdinate, checkLine);


            }

            Console.WriteLine("Hit {0} trees on that run!", treesHit);
            return treesHit;
        }
    }
}
